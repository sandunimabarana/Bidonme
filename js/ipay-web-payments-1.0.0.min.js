"use strict";var webPay,popupWindow=null,ipaywebpayment=function(o,n){webPay=new IpayWebPayment(o,$(n))};function IpayWebPayment(o,n){if(this.baseUrl="http://localhost:8080",this.env="",this.token={dev:"",sandbox:"",production:""},this.drawPayButton=!1,this.payment=function(){},this.onConfirm=function(o){},this.onCancel=function(){},this.onAuthorize=function(o){},this.onError=function(o){},"string"==typeof o.env&&(this.env=o.env),"object"==typeof o.token&&("string"==typeof o.token.dev&&(this.token.dev=o.token.dev),"string"==typeof o.token.sandbox&&(this.token.sandbox=o.token.sandbox),"string"==typeof o.token.production&&(this.token.production=o.token.production)),"boolean"==typeof o.drawPayButton&&(this.drawPayButton=o.drawPayButton),"function"==typeof o.payment&&(this.payment=o.payment),"function"==typeof o.onConfirm&&(this.onConfirm=o.onConfirm),"function"==typeof o.onCancel&&(this.onCancel=o.onCancel),"function"==typeof o.onAuthorize&&(this.onAuthorize=o.onAuthorize),"function"==typeof o.onError&&(this.onError=o.onError),"dev"===this.env||"sandbox"===this.env||"production"===this.env){if("dev"===this.env){if(this.baseUrl="https://developer.ipay.lk",!this.token.dev)return void console.error("Error: Token not found for env: "+this.env)}else if("sandbox"===this.env){if(this.baseUrl="https://sandbox.ipay.lk",!this.token.sandbox)return void console.error("Error: Token not found for env: "+this.env)}else if("production"===this.env&&(this.baseUrl="https://ipay.lk",!this.token.production))return void console.error("Error: Token not found for env: "+this.env);if(this.drawPayButton){if(!n.is("div"))return void console.error("Error: the element should be a div");var e=document.createElement("button");e.id="ipayPayButton",e.style.cssText="color: #fff; background-color: #337ab7; border-color: #2e6da4;display: inline-block; padding: 15px 60px; margin-bottom: 0; font-size: 14px; font-weight: 400; line-height: 1.42857143; text-align: right;white-space: nowrap; vertical-align: middle; -ms-touch-action: manipulation; touch-action: manipulation; cursor: pointer; -webkit-user-select: none;-moz-user-select: none; -ms-user-select: none; user-select: none; border: 1px solid transparent; border-radius: 4px;background-image: url('../resources/img/iPay-logo-white.png'); background-repeat: no-repeat; background-size: 30px; background-position: center;",e.onclick=function(o){t(o)},n.append(e)}else $(n).click(function(o){o.preventDefault(),t(o)});window.addEventListener?window.addEventListener("message",function(o){r(o)},!1):window.attachEvent("onmessage",function(o){r(o)}),console.log("iPay web payment successfully initialized")}else console.error("Error: Invalid env : "+this.env);function t(o){if(r=webPay.payment())if(r.totalAmount&&!isNaN(r.totalAmount)||console.error("Error: payInfo invalid amount"),r.currency)if("LKR"==r.currency.toUpperCase()){var n=screen.width/2-225,e="toolbar=no,scrollbars=1,location=no,statusbar=no,menubar=no,resizable=1,top="+(screen.height/2-260)+",left="+n+",width=450,height=520",t=webPay.baseUrl+"/webpay/";popupWindow=window.open(t,"ipay-webpayment",e);var r=webPay.payment(),i=location.origin,a={paymentConfig:{totalAmount:r.totalAmount,env:webPay.env,webToken:webPay.token,origin:i,additionalAttributes:r.additionalAttributes,subMerchantReference:r.subMerchantReference}};setTimeout(function(){popupWindow.postMessage(a,webPay.baseUrl)},4e3);var s=document.createElement("div");s.id="divIpayOverlay",s.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1040; background-color: rgba(0, 0, 0, 0.6); cursor: pointer;";var c=document.createElement("div");c.style.cssText="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 16px; font-weight: bold; color: #fff;";var u=document.createElement("img");u.src="../resources/img/iPay-logo-white.png",u.style.cssText="display:block; margin:auto; height: 75px; margin: auto; padding-botum; padding-bottom: 10px",c.appendChild(u),c.innerHTML+="Click to continue your payment",s.appendChild(c),s.onclick=function(){popupWindow&&!popupWindow.closed&&popupWindow.focus()},document.body.appendChild(s);var p=setInterval(function(){popupWindow.closed&&(clearInterval(p),document.body.removeChild(s))},1e3)}else console.error("Error: sorry, currently we are support LKR only");else console.error("Error: currency is required");else console.error("Error: payInfo not found")}function r(o){o.origin==webPay.baseUrl&&(o.data.onConfirm&&webPay.onConfirm(o.data.onConfirm),o.data.onAuthorize&&webPay.onAuthorize(o.data.onAuthorize))}}var payInfo=function(o){return o};IpayWebPayment.prototype={constructor:IpayWebPayment,onConfirm:function(){webPay.onConfirm()},onCancel:function(){webPay.onCancel()},onAuthorize:function(){webPay.onAuthorize()},onError:function(){webPay.onError()}};